name: CI/CD Pipeline

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  # ----------------------
  # Build Job
  # ----------------------
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-versiond: 18
      - name: Install Dependencies
        run: npm install || echo "No Package.json is found, skipping install"
        
      - run: npm install
      - run: echo "âœ… Build completed"

  # ----------------------
  # Test Job with Matrix + Selective Execution
  # ----------------------
  test:
    runs-on: ubuntu-latest
    needs: build
    strategy:
      matrix:
        node: [14, 16, 18]
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node }}
      - run: npm install

      # Run unit tests only if commit message contains [unit]
      - name: Run Unit Tests
        if: contains(github.event.head_commit.message, '[unit]')
        run: npm run test:unit

      # Run integration tests only if commit message contains [integration]
      - name: Run Integration Tests
        if: contains(github.event.head_commit.message, '[integration]')
        run: npm run test:integration

      # Fallback: run full test suite if no [unit] or [integration] specified
      - name: Run Full Test Suite
        if: ${{ !contains(github.event.head_commit.message, '[unit]') && !contains(github.event.head_commit.message, '[integration]') }}
        run: npm test

  # ----------------------
  # Deployment Job with Manual Approval
  # ----------------------
  deploy:
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    needs: test
    environment:
      name: production
      url: https://myapp.com
    steps:
      - run: echo "ðŸš€ Depl
